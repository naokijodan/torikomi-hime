<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>みちゃった君 × とりこみ君 連携設計書</title>
  <style>
    :root {
      --primary: #4A90D9;
      --secondary: #E74C3C;
      --success: #27AE60;
      --warning: #F39C12;
      --danger: #E74C3C;
      --dark: #2C3E50;
      --light: #ECF0F1;
      --michatta: #FF6B6B;
      --torikomi: #4ECDC4;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      color: white;
      padding: 40px 20px;
    }

    header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    header p {
      font-size: 1.2em;
      opacity: 0.9;
    }

    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      margin-bottom: 30px;
      overflow: hidden;
    }

    .card-header {
      padding: 20px 30px;
      color: white;
      font-size: 1.3em;
      font-weight: bold;
    }

    .card-header.michatta { background: var(--michatta); }
    .card-header.torikomi { background: var(--torikomi); }
    .card-header.workflow { background: var(--primary); }
    .card-header.problem { background: var(--danger); }
    .card-header.solution { background: var(--success); }
    .card-header.safety { background: var(--warning); }

    .card-body {
      padding: 30px;
    }

    /* 拡張機能比較表 */
    .compare-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .compare-table th, .compare-table td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    .compare-table th {
      background: var(--light);
      font-weight: bold;
    }

    .compare-table tr:hover {
      background: #f9f9f9;
    }

    /* ワークフロー図 */
    .workflow-diagram {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 20px;
    }

    .workflow-step {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .step-number {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5em;
      font-weight: bold;
      flex-shrink: 0;
    }

    .step-content {
      flex: 1;
      background: var(--light);
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid var(--primary);
    }

    .step-content h4 {
      color: var(--dark);
      margin-bottom: 10px;
    }

    .step-content.michatta { border-left-color: var(--michatta); }
    .step-content.torikomi { border-left-color: var(--torikomi); }
    .step-content.human { border-left-color: var(--success); }

    .arrow {
      text-align: center;
      font-size: 2em;
      color: var(--dark);
      opacity: 0.5;
    }

    /* 問題点リスト */
    .problem-list {
      list-style: none;
    }

    .problem-list li {
      padding: 15px 20px;
      margin: 10px 0;
      background: #FFF5F5;
      border-left: 4px solid var(--danger);
      border-radius: 8px;
    }

    .problem-list li::before {
      content: "⚠️ ";
    }

    .problem-list li strong {
      color: var(--danger);
    }

    /* 解決策リスト */
    .solution-list {
      list-style: none;
    }

    .solution-list li {
      padding: 15px 20px;
      margin: 10px 0;
      background: #F0FFF4;
      border-left: 4px solid var(--success);
      border-radius: 8px;
    }

    .solution-list li::before {
      content: "✅ ";
    }

    /* 安全策 */
    .safety-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .safety-item {
      background: #FFFBEB;
      padding: 20px;
      border-radius: 12px;
      border: 2px solid var(--warning);
      text-align: center;
    }

    .safety-item .icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .safety-item h4 {
      color: var(--dark);
      margin-bottom: 10px;
    }

    /* コード比較 */
    .code-compare {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .code-compare {
        grid-template-columns: 1fr;
      }
    }

    .code-block {
      background: #1E1E1E;
      color: #D4D4D4;
      padding: 20px;
      border-radius: 12px;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.9em;
      overflow-x: auto;
    }

    .code-block.current { border-top: 4px solid var(--danger); }
    .code-block.improved { border-top: 4px solid var(--success); }

    .code-block h5 {
      color: #888;
      margin-bottom: 15px;
      font-size: 1em;
    }

    .code-block .comment { color: #6A9955; }
    .code-block .keyword { color: #569CD6; }
    .code-block .string { color: #CE9178; }
    .code-block .function { color: #DCDCAA; }

    /* フロー図（ビジュアル） */
    .visual-flow {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 30px;
      background: linear-gradient(to right, #f8f9fa, #e9ecef, #f8f9fa);
      border-radius: 12px;
    }

    .flow-box {
      padding: 15px 25px;
      border-radius: 12px;
      color: white;
      font-weight: bold;
      text-align: center;
      min-width: 120px;
    }

    .flow-box.michatta { background: var(--michatta); }
    .flow-box.torikomi { background: var(--torikomi); }
    .flow-box.human { background: var(--success); }
    .flow-box.sheet { background: var(--primary); }
    .flow-box.auto { background: #9B59B6; }

    .flow-arrow {
      font-size: 1.5em;
      color: var(--dark);
    }

    /* バッジ */
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: bold;
      margin: 2px;
    }

    .badge.high { background: #FFEBEE; color: #C62828; }
    .badge.medium { background: #FFF3E0; color: #E65100; }
    .badge.low { background: #E8F5E9; color: #2E7D32; }
    .badge.priority { background: #E3F2FD; color: #1565C0; }

    /* タイムライン */
    .timeline {
      position: relative;
      padding-left: 30px;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--primary);
    }

    .timeline-item {
      position: relative;
      padding: 20px;
      margin-bottom: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -24px;
      top: 25px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--primary);
      border: 3px solid white;
    }

    /* 詳細セクション */
    details {
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
    }

    summary {
      padding: 15px 20px;
      background: var(--light);
      cursor: pointer;
      font-weight: bold;
      user-select: none;
    }

    summary:hover {
      background: #ddd;
    }

    details[open] summary {
      border-bottom: 1px solid #ddd;
    }

    details > div {
      padding: 20px;
    }

    /* メトリクス */
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .metric {
      text-align: center;
      padding: 20px;
      background: var(--light);
      border-radius: 12px;
    }

    .metric .value {
      font-size: 2.5em;
      font-weight: bold;
      color: var(--primary);
    }

    .metric .label {
      color: #666;
      font-size: 0.9em;
    }

    footer {
      text-align: center;
      color: white;
      padding: 30px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>みちゃった君 × とりこみ君</h1>
      <p>連携設計書 & 問題点・課題一覧</p>
      <p style="font-size: 0.9em; margin-top: 10px;">作成日: 2025年1月7日</p>
    </header>

    <!-- 現状の概要 -->
    <div class="card">
      <div class="card-header workflow">📊 現状の概要</div>
      <div class="card-body">
        <div class="metrics">
          <div class="metric">
            <div class="value">2</div>
            <div class="label">拡張機能</div>
          </div>
          <div class="metric">
            <div class="value">3</div>
            <div class="label">対応サイト（みちゃった君）</div>
          </div>
          <div class="metric">
            <div class="value">13</div>
            <div class="label">対応サイト（とりこみ君）</div>
          </div>
          <div class="metric">
            <div class="value">4</div>
            <div class="label">評価取得方法</div>
          </div>
        </div>

        <table class="compare-table">
          <thead>
            <tr>
              <th>項目</th>
              <th style="background: #FFE5E5;">みちゃった君 v3.1.1</th>
              <th style="background: #E5FFFA;">とりこみ君 v1.2.2</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>主な機能</strong></td>
              <td>閲覧済みマーク、評価チェック、バックグラウンドタブ</td>
              <td>商品情報スクレイピング、Sheetsエクスポート</td>
            </tr>
            <tr>
              <td><strong>対応サイト</strong></td>
              <td>メルカリ、ラクマ、楽天市場</td>
              <td>eBay、楽天、Amazon、メルカリ、ヤフオク、PayPayフリマ、ラクマ</td>
            </tr>
            <tr>
              <td><strong>評価取得</strong></td>
              <td>data-testid="seller-link" から取得（高精度）</td>
              <td>複数方法（フリマアシスト、span検索、テキスト検索）</td>
            </tr>
            <tr>
              <td><strong>Gitリポジトリ</strong></td>
              <td>あり（5コミット確認済み）</td>
              <td>なし</td>
            </tr>
            <tr>
              <td><strong>Chrome Web Store</strong></td>
              <td>未確認</td>
              <td>公開済み</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 提案ワークフロー -->
    <div class="card">
      <div class="card-header workflow">🔄 提案ワークフロー</div>
      <div class="card-body">
        <h3 style="margin-bottom: 20px;">段階的フィルタリング + 条件付き自動クローズ + ステータス同期</h3>

        <div class="visual-flow">
          <div class="flow-box michatta">検索一覧<br>みちゃった君</div>
          <div class="flow-arrow">→</div>
          <div class="flow-box human">チェック<br>ボタン</div>
          <div class="flow-arrow">→</div>
          <div class="flow-box auto">バックグラウンド<br>タブオープン</div>
          <div class="flow-arrow">→</div>
          <div class="flow-box torikomi">とりこみ君<br>自動処理</div>
          <div class="flow-arrow">→</div>
          <div class="flow-box sheet">Sheets<br>エクスポート</div>
        </div>

        <div class="workflow-diagram" style="margin-top: 30px;">
          <div class="workflow-step">
            <div class="step-number">1</div>
            <div class="step-content michatta">
              <h4>粗選別（みちゃった君）</h4>
              <p>検索一覧で「チェック」ボタンを押し、評価・発送日数を事前確認。条件に合わない商品は「興味なし」マークでグレーアウト。</p>
              <p><span class="badge priority">人間の判断</span> <span class="badge low">低リスク</span></p>
            </div>
          </div>

          <div class="arrow">↓</div>

          <div class="workflow-step">
            <div class="step-number">2</div>
            <div class="step-content human">
              <h4>一括チェック（人間トリガー）</h4>
              <p>「一括チェック」ボタンで選択した商品（最大10件）をバックグラウンドで開く。<strong>300ms間隔</strong>で順次オープン。</p>
              <p><span class="badge priority">人間のクリック</span> <span class="badge medium">中リスク</span></p>
            </div>
          </div>

          <div class="arrow">↓</div>

          <div class="workflow-step">
            <div class="step-number">3</div>
            <div class="step-content torikomi">
              <h4>自動処理（とりこみ君）</h4>
              <p>開かれたタブをとりこみ君が検知し、DOM解析を実行。</p>
              <ul style="margin-top: 10px;">
                <li><strong>NGワード検出</strong> → タブを即閉じ</li>
                <li><strong>条件クリア</strong> → エクスポート後に閉じ</li>
                <li><strong>判断不能</strong> → タブを残す（人間確認用）</li>
              </ul>
              <p><span class="badge low">自動化</span></p>
            </div>
          </div>

          <div class="arrow">↓</div>

          <div class="workflow-step">
            <div class="step-number">4</div>
            <div class="step-content michatta">
              <h4>フィードバック（みちゃった君）</h4>
              <p>とりこみ君からの処理結果を受け取り、検索一覧の商品パネルにステータスを表示。</p>
              <div style="margin-top: 10px;">
                <span style="background: #27AE60; color: white; padding: 5px 10px; border-radius: 5px; margin-right: 5px;">緑：エクスポート済み</span>
                <span style="background: #95A5A6; color: white; padding: 5px 10px; border-radius: 5px; margin-right: 5px;">グレー：NG除外</span>
                <span style="background: #F39C12; color: white; padding: 5px 10px; border-radius: 5px;">黄：要確認</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 問題点・課題 -->
    <div class="card">
      <div class="card-header problem">⚠️ 問題点・課題一覧</div>
      <div class="card-body">

        <h3 style="margin-bottom: 15px;">🔴 評価取得の問題（最優先）</h3>
        <ul class="problem-list">
          <li>
            <strong>評価件数が0になる</strong>
            <p>data-testid="seller-link" が存在しない場合、フォールバック処理が不十分。みちゃった君は対応済みだが、とりこみ君は未対応。</p>
          </li>
          <li>
            <strong>数値が間違っている</strong>
            <p>評価件数の近くに他の数値（フォロワー数、出品数など）があると誤取得。正規表現のパターンが曖昧。</p>
          </li>
          <li>
            <strong>取得できないケースがある</strong>
            <p>メルカリのDOM構造が動的に変わる。SPAのため、ページ遷移時にDOMが完全にロードされていない可能性。</p>
          </li>
          <li>
            <strong>メルカリショップとの混同</strong>
            <p>通常メルカリ（/item/）とショップ（/shops/product/）で評価の表示形式が異なる。ショップは★評価のみで良い/悪いの内訳がない。</p>
          </li>
        </ul>

        <details>
          <summary>📊 評価取得方法の比較（みちゃった君 vs とりこみ君）</summary>
          <div>
            <div class="code-compare">
              <div class="code-block improved">
                <h5>みちゃった君（改善済み）</h5>
                <pre>
<span class="comment">// 方法1（最優先）: data-testid="seller-link"</span>
<span class="keyword">const</span> sellerLink = document.<span class="function">querySelector</span>(
  <span class="string">'[data-testid="seller-link"]'</span>
);
<span class="keyword">if</span> (sellerLink) {
  <span class="keyword">const</span> allNumbers = sellerText.<span class="function">match</span>(/\d+/g);
  <span class="comment">// 732=合計, 730=良い, 2=悪い</span>
}
                </pre>
              </div>
              <div class="code-block current">
                <h5>とりこみ君（要改善）</h5>
                <pre>
<span class="comment">// 方法1: #furima-assist-seller-ratings</span>
<span class="keyword">const</span> assistRatings = document.<span class="function">querySelector</span>(
  <span class="string">"#furima-assist-seller-ratings"</span>
);
<span class="comment">// フリマアシスト依存 → 未インストールだと失敗</span>

<span class="comment">// 方法2: span要素検索（誤検出リスク高）</span>
<span class="keyword">const</span> allSpans = document.<span class="function">querySelectorAll</span>(
  <span class="string">'[class*="Rating"] span'</span>
);
                </pre>
              </div>
            </div>
          </div>
        </details>

        <h3 style="margin: 30px 0 15px;">🟡 キーボードショートカットの問題</h3>
        <ul class="problem-list">
          <li>
            <strong>とりこみ姫のショートカットが動作しない</strong>
            <p>Ctrl+Shift+E / Command+Shift+E が押せない。他の拡張機能とのショートカット競合か、manifest.jsonのcommands設定の問題の可能性。</p>
            <p><span class="badge medium">要調査</span></p>
          </li>
        </ul>

        <details>
          <summary>🔧 考えられる原因</summary>
          <div>
            <ol>
              <li><strong>ショートカット競合</strong>: 他の拡張機能（例：Vimium、1Password）が同じキーを使用</li>
              <li><strong>Chrome設定</strong>: chrome://extensions/shortcuts でコマンドが正しく登録されているか確認</li>
              <li><strong>background.jsのリスナー不足</strong>: chrome.commands.onCommand リスナーが正しく実装されているか</li>
              <li><strong>content scriptとの連携</strong>: background → content へのメッセージパッシングの問題</li>
            </ol>
          </div>
        </details>

        <h3 style="margin: 30px 0 15px;">🟠 拡張機能間連携の課題</h3>
        <ul class="problem-list">
          <li>
            <strong>メッセージパッシングの仕組みがない</strong>
            <p>みちゃった君とりこみ君間でchrome.runtime.sendMessageやchrome.storageを使った連携が未実装。</p>
          </li>
          <li>
            <strong>処理ステータスの同期がない</strong>
            <p>とりこみ君がタブを閉じても、みちゃった君側に結果がフィードバックされない。</p>
          </li>
          <li>
            <strong>拡張機能IDの参照方法</strong>
            <p>拡張機能間でメッセージを送るには相手の拡張機能IDが必要。ハードコードするか、外部サービス経由にするか要検討。</p>
          </li>
        </ul>
      </div>
    </div>

    <!-- アカウント保護 -->
    <div class="card">
      <div class="card-header safety">🛡️ アカウント保護の安全策</div>
      <div class="card-body">
        <p style="margin-bottom: 20px;">メルカリなどのアカウント停止を防ぐための「いい塩梅」</p>

        <div class="safety-grid">
          <div class="safety-item">
            <div class="icon">👆</div>
            <h4>人間のクリックをトリガーに</h4>
            <p>完全自動巡回はNG。ボタン押下を必ず介在させる</p>
          </div>
          <div class="safety-item">
            <div class="icon">🔢</div>
            <h4>10件以下 / 300ms以上</h4>
            <p>一度に開くタブ数と間隔を制限し、人間らしいペースを維持</p>
          </div>
          <div class="safety-item">
            <div class="icon">📄</div>
            <h4>DOM解析のみ</h4>
            <p>APIを直接叩かない。ページのHTMLをパースするだけ</p>
          </div>
          <div class="safety-item">
            <div class="icon">⏱️</div>
            <h4>自然な滞在時間</h4>
            <p>検索一覧で「処理結果を待つ」時間が自然な滞在時間になる</p>
          </div>
          <div class="safety-item">
            <div class="icon">🎯</div>
            <h4>明確なNGルールのみ</h4>
            <p>「ジャンク」「欠品」など確実に判定できるものだけ自動処理</p>
          </div>
          <div class="safety-item">
            <div class="icon">🧑</div>
            <h4>曖昧な判断は人間に</h4>
            <p>判断に迷うケースはタブを残し、人間が確認</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 解決策・改善案 -->
    <div class="card">
      <div class="card-header solution">✅ 解決策・改善案</div>
      <div class="card-body">

        <h3 style="margin-bottom: 15px;">評価取得の改善</h3>
        <ul class="solution-list">
          <li>
            <strong>とりこみ君にdata-testid="seller-link"を追加</strong>
            <p>みちゃった君と同じ方法を最優先にする。フリマアシスト依存を解消。</p>
          </li>
          <li>
            <strong>メルカリショップ専用の取得ロジック</strong>
            <p>data-testid="shops-information" または "shops-profile-link" から評価数を取得。</p>
          </li>
          <li>
            <strong>DOMロード待機の強化</strong>
            <p>MutationObserverを使って評価要素が挿入されるまで待機する。</p>
          </li>
          <li>
            <strong>数値検証ロジックの追加</strong>
            <p>合計 = 良い + 悪い (+ 普通) を検証し、一致しない場合は再取得を試みる。</p>
          </li>
        </ul>

        <h3 style="margin: 30px 0 15px;">拡張機能間連携の実装</h3>
        <ul class="solution-list">
          <li>
            <strong>chrome.storage.localを使った共有ステータス</strong>
            <p>処理中の商品ID、処理結果をstorageに書き込み、お互いが参照する。</p>
          </li>
          <li>
            <strong>window.postMessageによる同一タブ内通信</strong>
            <p>同じページに両方のcontent scriptが読み込まれる場合、postMessageで通信。</p>
          </li>
          <li>
            <strong>処理結果のフィードバックUI</strong>
            <p>みちゃった君の検索一覧に処理結果バッジを表示。</p>
          </li>
        </ul>

        <h3 style="margin: 30px 0 15px;">ショートカット問題の調査</h3>
        <ul class="solution-list">
          <li>
            <strong>chrome://extensions/shortcuts で競合確認</strong>
            <p>他の拡張機能が同じショートカットを使っていないか確認。</p>
          </li>
          <li>
            <strong>background.jsのcommands.onCommand実装確認</strong>
            <p>リスナーが正しく動作しているかconsole.logで確認。</p>
          </li>
        </ul>
      </div>
    </div>

    <!-- 実装優先順位 -->
    <div class="card">
      <div class="card-header workflow">📋 実装優先順位</div>
      <div class="card-body">
        <div class="timeline">
          <div class="timeline-item">
            <h4><span class="badge high">優先度: 高</span> 評価取得の改善</h4>
            <p>とりこみ君にdata-testid="seller-link"とdata-testid="shops-information"の取得を追加。みちゃった君と同じ精度を実現。</p>
          </div>
          <div class="timeline-item">
            <h4><span class="badge high">優先度: 高</span> ショートカット問題の調査・修正</h4>
            <p>とりこみ姫のキーボードショートカットが動作しない原因を特定し修正。</p>
          </div>
          <div class="timeline-item">
            <h4><span class="badge medium">優先度: 中</span> 拡張機能間連携の設計</h4>
            <p>chrome.storageを使ったステータス共有の仕組みを設計・実装。</p>
          </div>
          <div class="timeline-item">
            <h4><span class="badge medium">優先度: 中</span> 自動クローズ機能の実装</h4>
            <p>NGワード検出時の自動タブクローズ、エクスポート完了後のクローズを実装。</p>
          </div>
          <div class="timeline-item">
            <h4><span class="badge low">優先度: 低</span> フィードバックUIの実装</h4>
            <p>みちゃった君の検索一覧に処理結果バッジを表示する機能。</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 技術詳細 -->
    <div class="card">
      <div class="card-header workflow">🔧 技術詳細</div>
      <div class="card-body">
        <details>
          <summary>評価取得のDOM要素（メルカリ通常）</summary>
          <div>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto;">
&lt;a data-testid="seller-link" href="/mypage/..."&gt;
  CLOVER‎ フォロー割引・まとめ割引

  873        ← 合計評価数
   871  2    ← 良い評価、悪い評価
  本人確認済
&lt;/a&gt;
            </pre>
            <p style="margin-top: 10px;">innerTextから数値を抽出: ["873", "871", "2"] → 合計=873, 良い=871, 悪い=2</p>
          </div>
        </details>

        <details>
          <summary>評価取得のDOM要素（メルカリショップ）</summary>
          <div>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto;">
&lt;div data-testid="shops-information"&gt;
  韓国フリマアプリ雷市場（ポンジャン）

  33365      ← ショップ評価数

  メルカリShops
&lt;/div&gt;
            </pre>
            <p style="margin-top: 10px;">innerTextから数値を抽出し、最大値を評価数とする: 33365</p>
          </div>
        </details>

        <details>
          <summary>拡張機能間通信の実装案</summary>
          <div>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto;">
// chrome.storage.local を使った共有
// みちゃった君側: 処理対象を登録
chrome.storage.local.set({
  'michatta_processing': {
    itemId: 'm12345678901',
    url: 'https://jp.mercari.com/item/m12345678901',
    status: 'pending',
    timestamp: Date.now()
  }
});

// とりこみ君側: 処理結果を更新
chrome.storage.local.get('michatta_processing', (data) => {
  if (data.michatta_processing) {
    // 処理を実行
    chrome.storage.local.set({
      'michatta_result': {
        itemId: data.michatta_processing.itemId,
        status: 'exported', // or 'ng_keyword' or 'needs_review'
        reason: 'エクスポート完了',
        timestamp: Date.now()
      }
    });
  }
});

// みちゃった君側: 結果を監視
chrome.storage.onChanged.addListener((changes, area) => {
  if (area === 'local' && changes.michatta_result) {
    const result = changes.michatta_result.newValue;
    // UIを更新
    updateItemCard(result.itemId, result.status);
  }
});
            </pre>
          </div>
        </details>
      </div>
    </div>

    <footer>
      <p>このドキュメントはClaude、GPT-5、Geminiの3者協議に基づいて作成されました。</p>
      <p>© 2025 みちゃった君 × とりこみ君 プロジェクト</p>
    </footer>
  </div>
</body>
</html>
